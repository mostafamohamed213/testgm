
@model CGARMAN.ViewModel.Vehicle.VehicleCreateViewModel
@{
    ViewData["Title"] = "Create Vehicle";
    Layout = "_Authenticated";
    int endYear = DateTime.Now.Year + 3;
}
<div class="d-sm-flex align-items-center justify-content-between mb-4" style="margin-left:10px">
    <h1 class="h3 mb-0 text-gray-800">
        Create Vehicle
    </h1>
    <a style="margin-right:10px" asp-action="Index" asp-controller="Home" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">Back to Home</a>
</div>
<hr />
<div class="row" style="margin:1%">
    <div class="col-lg-12">
        <form asp-action="Create" asp-controller="Vehicle" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group row">
                <div class="col-xl-12">

                    <div class="row">
                        <div class="col-xl-4">
                            <div>
                                <label class="col-form-label">Family</label>
                                <select asp-for="VehicleFamilyId" asp-items="Model.Families" onchange="getBrandByfamilyId(this.value); valAttributes();" class="form-control form-control-user w-100">
                                    <option>Please select one</option>
                                </select>
                                <span asp-validation-for="VehicleFamilyId" style="margin:auto" class="text-danger"></span>
                            </div>
                          
                            <div>
                                <label class="col-form-label">Brand</label>
                                <select asp-for="VehicleBrandId" class="form-control form-control-user w-100">
                                    <option>Please select one</option>
                                </select>
                                <span asp-validation-for="VehicleBrandId" style="margin:auto" class="text-danger"></span>
                            </div>
                          
                            <div>
                                <label class="col-form-label">Department</label>
                                <select asp-for="VehicleDepartmentId" asp-items="Model.Departments" class="form-control form-control-user w-100">
                                    <option>Please select one</option>
                                </select>
                                <span asp-validation-for="VehicleDepartmentId" style="margin:auto" class="text-danger"></span>
                            </div>
                           
                            <div>
                                <label class="col-form-label">Owner</label>
                                <select asp-for="VehicleOwnerId" asp-items="Model.Owners" class="form-control form-control-user w-100">
                                    <option>Please select one</option>
                                </select>
                                <span asp-validation-for="VehicleOwnerId" style="margin:auto" class="text-danger"></span>
                            </div>
                           
                            <div>
                                <label class="col-form-label">Plate Number</label>
                                <input type="text" asp-for="LicenseNumber" onkeypress="return CheckArabicCharactersOnly(event);" class="form-control form-control-user" dir="rtl" />
                                <span asp-validation-for="LicenseNumber" style="margin:auto" class="text-danger"></span>
                            </div>
                         

                        </div>

                        <div class="col-xl-4">
                            <div>
                                <label class="col-form-label">Tire Size</label>
                                <select asp-for="TireSizeId" asp-items="Model.TireSizes" class="form-control form-control-user w-100">
                                    <option>Please select one</option>
                                </select>
                                <span asp-validation-for="TireSizeId" style="margin:auto" class="text-danger"></span>
                            </div>
                          
                            <div>
                                <label class="col-form-label">Manufacturing Year</label>
                                <select asp-for="ManufacturingYear" class="form-control form-control-user w-100">
                                    <option>Please select one</option>
                                    @for (int startYear = 1970; startYear < endYear; startYear++)
                                    {
                                        <option value="@startYear">@startYear</option>
                                    }
                                </select>
                                <span asp-validation-for="ManufacturingYear" style="margin:auto" class="text-danger"></span>
                            </div>
                          
                            <div>
                                <label class="col-form-label">Cost Center</label>
                                <select asp-for="CostCenterId" asp-items="Model.CostCenters" class="form-control form-control-user w-100">
                                    <option>Please select one</option>
                                </select>
                                <span asp-validation-for="CostCenterId" style="margin:auto" class="text-danger"></span>
                            </div>
                          
                            <div>
                                <label class="col-form-label">Status</label>
                                <select asp-for="VehicleStatusId" asp-items="Model.Status" class="form-control form-control-user w-100">
                                    <option>Please select one</option>
                                </select>
                                <span asp-validation-for="VehicleStatusId" style="margin:auto" class="text-danger"></span>

                            </div>
                         
                            <div>
                                <label class="col-form-label">Tires Count</label>
                                <input type="number" min="4" asp-for="TiresCount" class="form-control form-control-user" />
                                <span asp-validation-for="TiresCount" style="margin:auto" class="text-danger"></span>
                            </div>
                           
                        </div>

                        <div class="col-xl-4" id="extraAttributes">
                         
                            <div>
                                <label class="col-form-label">Capacity</label>
                                <input type="text" asp-for="Capacity" class="form-control form-control-user" />
                                <span asp-validation-for="Capacity" style="margin:auto" class="text-danger"></span>
                            </div>
                         
                            <div>
                                <label class="col-form-label">Chassis Type</label>
                                <input type="text" asp-for="ChassisType" class="form-control form-control-user" />
                                <span asp-validation-for="ChassisType" style="margin:auto" class="text-danger"></span>
                            </div>
                       
                            <div>
                                <label class="col-form-label">Chassis Serial</label>
                                <input type="text" asp-for="ChassisSerial" class="form-control form-control-user" />
                                <span asp-validation-for="ChassisSerial" style="margin:auto" class="text-danger"></span>
                            </div>
                          
                            <div>
                                <label class="col-form-label">Engine Type</label>
                                <input type="text" asp-for="EngineType" class="form-control form-control-user" />
                                <span asp-validation-for="EngineType" style="margin:auto" class="text-danger"></span>
                            </div>
                         
                            <div>
                                <label class="col-form-label">Engine Serial</label>
                                <input type="text" asp-for="EngineSerial" class="form-control form-control-user" />
                                <span asp-validation-for="EngineSerial" style="margin:auto" class="text-danger"></span>
                            </div>                          

                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-lg-1">
                            <label>Notes</label>
                        </div>
                        <div class="col-lg-11">
                            <textarea rows="3" asp-for="Notes" name="Notes" cols="40" class="form-control form-control-user">
                                 </textarea>
                            <span asp-validation-for="Notes" class="text-danger"></span>

                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" style=" width: 150px; margin: 30px 40px;" class="btn btn-success" />
            </div>
        </form>
    </div>
</div>


@section Scripts{
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
    <script>
        document.getElementById("btncontainerVehicles").click();
        ToggleColorInDashboard("linkAllCreateVehicle");
        document.getElementById("btnGoToTopPage").click();

        var familyVal = document.getElementById('VehicleFamilyId').value;
        if (familyVal  > 0) {
            getBrandByfamilyId(familyVal);
            @*var brandVal = "@Model.VehicleBrandId";
            if (brandVal > 0) {
                alert(brandVal);
                document.getElementById('VehicleBrandId').value = brandVal;
            }*@
        }
        function valAttributes() {
            var e = document.getElementById("VehicleFamilyId");
            var text = e.options[e.selectedIndex].text;

            var engineSerial = document.getElementById("EngineSerial");
            var engineType = document.getElementById("EngineType");
            var chassisSerial = document.getElementById("ChassisSerial");
            var chassisType = document.getElementById("ChassisType");
            var capacity = document.getElementById("Capacity");
            var extraAttributes = document.getElementById("extraAttributes");
            if (text.toLowerCase().trim() == 'silo' || text.toLowerCase().trim() == 'trailer') {
                engineSerial.value = "";
                engineType.value = "";
                chassisSerial.value = "";
                chassisType.value = "";
                capacity.value = "";
                extraAttributes.style.display = "none";
            } else {
               extraAttributes.style.display = "block";
            }
        }

        function getBrandByfamilyId(val) {
            $("#VehicleBrandId").empty();
            var select = document.getElementById('VehicleBrandId');
            var opt = document.createElement('option');
            opt.innerHTML = "Please select one";
            select.appendChild(opt);
            var brandVal = @Model.VehicleBrandId;

            if (val > 0) {
                $.ajax({
                    type: "Post",
                    url: "/Vehicle/getBrandByfamilyId",
                    data: { "FamilyId": val},
                    success: function (response) {

                        if (response.status == 1) {

                            $.each(response.object, (i, e) => {
                                var opt = document.createElement('option');
                                opt.value = e.value;
                                opt.innerHTML = e.text;
                                select.appendChild(opt);
                            });
                            if (brandVal > 0) {
                                select.value = brandVal;
                            }


                        } else {
                            throwException(response.object);
                        }
                    },
                    failure: function (response) {
                        throwException(response)
                    },
                    error: function (response) {
                        throwException(response)
                    }
                })
            }

        }


        function restrictInputOtherThanArabic($field) {
            // Arabic characters fall in the Unicode range 0600 - 06FF
            var arabicCharUnicodeRange = /[\u0600-\u06FF]/;

            $field.bind("keypress", function (event) {
                var key = event.which;
                // 0 = numpad
                // 8 = backspace
                // 32 = space
                if (key == 8 || key == 0 || key === 32) {
                    return true;
                }

                var str = String.fromCharCode(key);
                if (arabicCharUnicodeRange.test(str)) {
                    return true;
                }

                return false;
            });
        }
        //$(document).ready(function () {
        //    restrictInputOtherThanArabic($('#LicenseNumber'));
        //});
      
    </script>
    <script>
            // Allow Arabic Characters only
            function CheckArabicCharactersOnly(e) {
                var unicode = e.charCode ? e.charCode : e.keyCode
                if (unicode != 8) { //if the key isn't the backspace key (which we should allow)
                    if (unicode == 32)
                        return true;
                    else {
                        if ((unicode < 48 || unicode > 57) && (unicode < 0x0600 || unicode > 0x06FF)) //if not a number or arabic
                            return false; //disable key press
                    }
                }
            }
            
    </script>


}