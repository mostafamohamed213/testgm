
@model CGARMAN.ViewModel.InventoryViewModels.InventoryItemWarehouseSpareparts
@*<script src='~/make-dropdown-with-search-box/jquery-3.2.1.min.js' type='text/javascript'></script>*@
<script src='~/make-dropdown-with-search-box/select2/dist/js/select2.min.js' type='text/javascript'></script>

<link href='~/make-dropdown-with-search-box/select2/dist/css/select2.min.css' rel='stylesheet' type='text/css'>
<style>
    @@media (min-width: 977px) {
        #divTirePatterncon, #divTireSizecon, #divViscositycon, #divcodetypeco, #SelStatusWarehouse {
            padding-right: 0px;
        }
        /* #divcontainerPopupAddCodeType, #divcontainerPopupVendor{
            padding: 1px;
        }
        #divcontaineraddSerialNumber {
            padding: 0px;
        }*/
    }

    @@media (min-width: 977px) and (max-width: 2000px) {
        #divTirePatterncon, #divTireSizecon, #divViscositycon, #divcodetypeco, #SelStatusWarehouse {
            padding-right: 15px;
            padding-left: 15px;
        }
        /*#divcontainerPopupAddCodeType, #divcontainerPopupVendor, #divcontaineraddSerialNumber {
            padding: 2px 17px;
        }*/
    }
</style>

<div>
    <div class="d-sm-flex align-items-center justify-content-between mb-4" style="margin-left:10px">
        <h1 class="h3 mb-0 text-gray-800">
            Add Quantities <i style="font-size:large" class="fa fa-arrow-right" aria-hidden="true"></i> @ViewBag.InventoryItemTypeName
        </h1>
        <button style="margin-right:10px" onclick="gotoItemType(@ViewBag.InventoryItemTypeId)" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">Back to Item</button>
    </div>
    <hr />
    <div class="row" style="margin:0px 15px">
        @if (ViewBag.ValMassage != null)
        {
            <p style="color:red">@ViewBag.ValMassage</p>
        }
    <form asp-action="CreateItemForSpareparts" asp-controller="InventoryItem" method="post" id="frmSubmitInvItem" class="col-12">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="InventoryItemTypeId" />
        <input type="hidden" asp-for="InventoryItemId" />
        <div class="form-group row">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-1" style=" padding-top: 5px;">
                        <label>Warehouse</label>
                    </div>
                    <div class="col-md-3">
                        <select asp-items="ViewBag.Warehouses" asp-for="WarehouseId" class="form-control form-control-user" disabled>
                        </select>

                        <span asp-validation-for="WarehouseId" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                    </div>
                </div>
            </div>
        </div>

        <div>
            <div class="form-group row">
                <div class="col-lg-4">
                    <div class="row">
                        <div class="col-lg-5" style=" padding-top: 5px;">
                            <label>Sub-Warehouse</label>
                        </div>
                        <div class="col-lg-7">
                            <select class="form-control form-control-user" asp-for="SubWarehouseId" id="selSubWarehouseId" asp-items="ViewBag.SubWarehouseStructure" onchange="GetLaneWarehouse(this.value)">
                                <option value="-1">Please select one</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="row">
                        <div class="col-lg-3" style=" padding-top: 5px;">
                            <label>Lane</label>
                        </div>
                        <div class="col-lg-9">
                            <select class="form-control form-control-user" asp-for="LaneId" id="selLaneWarehouse" onchange="GetShelfWarehouse(this.value)">
                                <option value="-1">Please select one</option>
                            </select>

                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="row">
                        <div class="col-lg-3" style="padding-top: 5px;">
                            <label>Shelf</label>
                        </div>
                        <div class="col-lg-9">
                            <select asp-for="InventoryLocationId" id="selInventoryShelfId" class="form-control form-control-user">
                                <option>Please select one</option>
                            </select>
                            <span asp-validation-for="InventoryLocationId" class="text-danger"></span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <hr class="sidebar-divider bg-gradient-primary">
        <div class="row" style=" padding: 5px 0px;">
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Unit Price</label>
                    </div>
                    <div class="col-lg-7">
                        <input type="number" asp-for="UnitCost" class="form-control form-control-user" />
                        <span asp-validation-for="UnitCost" class="text-danger"></span>
                    </div>
                    <div class="col-lg-1">
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Status</label>
                    </div>
                    <div class="col-lg-7">
                        <select class="form-control form-control-user" asp-items="ViewBag.status" asp-for="InventoryItemStatusId">
                            <option>Please select one</option>
                        </select>
                        <span asp-validation-for="InventoryItemStatusId" class="text-danger"></span>
                    </div>
                    <div class="col-lg-1">
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Quantity</label>
                    </div>
                    <div class="col-lg-7">
                        @if (ViewBag.unitId == 1)
                        {
                            <input type="number" value="1" class="form-control form-control-user" disabled />
                        }
                        else
                        {
                            <input type="number" asp-for="Quantity" class="form-control form-control-user" disabled />
                        }

                        <span asp-validation-for="Quantity" class="text-danger"></span>
                    </div>
                    <div class="col-lg-1">
                    </div>
                </div>
            </div>

        </div>
        <div class="row" style=" padding: 5px 0px;">
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Issue Number</label>
                    </div>
                    <div class="col-lg-7">
                        <input type="text" asp-for="IssueNumber" class="form-control form-control-user" />
                        <span asp-validation-for="IssueNumber" class="text-danger"></span>
                    </div>
                    <div class="col-lg-1">
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Code Type</label>
                    </div>
                    <div class="col-lg-7">
                        <select class="form-control form-control-user" asp-for="CodeTypeId" asp-items="ViewBag.CodeType" id='selCodeType' onchange="onChangeselCodeType(this.value)">
                            <option value="-1">No Code</option>
                        </select>
                        <span asp-validation-for="CodeTypeId" class="text-danger"></span>
                    </div>
                    <div class="col-lg-1" style="padding: 0px;" id="divcontainerPopupAddCodeType">
                        <partial name="PopupAddCodeType" />
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Code</label>
                    </div>
                    <div class="col-lg-7">
                        <input type="text" asp-for="Code" id="selCode" class="form-control form-control-user" />
                        <span asp-validation-for="Code" class="text-danger"></span>
                    </div>
                    <div class="col-lg-1">
                    </div>
                </div>
            </div>

        </div>

        <div class="row" style=" padding: 5px 0px;">
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Supplier</label>
                    </div>
                    <div class="col-lg-7">
                        <select class="form-control form-control-user" style="width:100%" asp-items="ViewBag.Suppliers" asp-for="VendorId" id='selSupplier'>
                        </select>
                        <span asp-validation-for="VendorId" class="text-danger"></span>
                    </div>
                    <div class="col-lg-1" style="padding: 0px;" id="divcontainerPopupVendor">

                        <partial name="_addPopupVendor" />
                    </div>
                </div>

            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Part Number</label>
                    </div>
                    <div class="col-lg-7">
                        <input type="text" asp-for="PartNumber" class="form-control form-control-user" />
                        <span asp-validation-for="PartNumber" class="text-danger"></span>
                    </div>
                    <div class="col-lg-1">
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-lg-4">
                        <label>Serial Number</label>
                    </div>
                    <div class="col-lg-7">
                        @if (ViewBag.AutoGenerateSerial || ViewBag.unitId != 1)
                        {
                            <input type="text" asp-for="SerialNumbers" class="form-control form-control-user" disabled />
                        }
                        else
                        {
                            <input type="text" asp-for="SerialNumbers" class="form-control form-control-user" />
                        }
                        @*<span asp-validation-for="SerialNumbers" class="text-danger"></span>*@
                        @if (ViewBag.valSerialNumber != null)
                        {
                            <span class="text-danger">@ViewBag.valSerialNumber</span>
                        }
                    </div>
                    <div class="col-lg-1" style=" padding: 0px;">

                    </div>
                </div>

            </div>

        </div>
        <div class="row">
            <div class="col-lg-8">
                <div class="row" style=" padding-top: 10px; ">
                    <div class="col-lg-2">
                        <label>Notes</label>
                    </div>
                    <div class="col-lg-10">
                        <textarea rows="3" asp-for="Notes" name="Notes" cols="40" class="form-control form-control-user">
                                 </textarea>
                        <span asp-validation-for="Notes" class="text-danger"></span>

                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div id="containerSerialNumber" style="max-height: 130px; overflow: hidden; overflow-y: scroll ">
                </div>
            </div>
        </div>


        <input type="hidden" id="inputSerialNumberValues" asp-for="SerialNumbers" />
        <input type="hidden" id="inputAutoGenerateSerial" value="@ViewBag.AutoGenerateSerial" />
        <input type="hidden" id="unitId4353" value="@ViewBag.unitId" name="unitId" />
        @if (ViewBag.AutoGenerateSerial)
        {
            <input type="hidden" id="inputflagAutoGenerateS" value="1" />
        }
        else
        {
            <input type="hidden" id="inputflagAutoGenerateS" value="-1" />
        }

        <div class="form-group">

            <input type="button" onclick="submitInvItem()" value="Save" id="btnsubmitInvItem" class="btn btn-primary" />

        </div>
        <input type="hidden" asp-for="SubWarehouseId" />
        <input type="hidden" asp-for="LaneId" />
        <input type="hidden" asp-for="InventoryLocationId" />

    </form>
       
    </div>
</div>

<script>
    $("#selSupplier").select2();
    $("#selModel").select2();
    $("#selbrand").select2();
  
    function GetLaneWarehouse(v)
    {
        let laneValue = LaneId.value;

        if (v != -1) {
            $.ajax({
                type: "Get",
                url: "/InventoryItem/GetLaneWarehouse",
                data: { "subWarehouseId": v },
                success: function (response) {
                    if (response.status == 1) {
                        $("#selLaneWarehouse").empty();
                        response.object.forEach(function (i) {
                            var option = document.createElement("option");
                            option.text = i.text;
                            option.value = i.value;
                            if (laneValue != null && laneValue != "null" && laneValue != "" && laneValue == i.value) {
                                option.selected = true ;
                            }
                            $('#selLaneWarehouse').append(option);
                        });
                        GetShelfWarehouse(selLaneWarehouse.value);
                    } else {
                        throwException(response);
                    }
                },
                failure: function (response) {
                    throwException(response)
                },
                error: function (response) {
                    throwException(response)
                }
            });
        } else {
            $("#selLaneWarehouse").empty();
            $("#selInventoryShelfId").empty();
            var option = document.createElement("option");
            option.text = "Please select one";
            $('#selInventoryShelfId').append(option);
            var option1 = document.createElement("option");
            option1.text = "Please select one";
            $('#selLaneWarehouse').append(option1);
        }

    }

    function GetShelfWarehouse(v) {
        let LocationIdValue = InventoryLocationId.value;
        if (v != -1) {
            $.ajax({
                type: "Get",
                url: "/InventoryItem/GetShelfWarehouse",
                data: { "laneWarehouseId": v },
                success: function (response) {
                    if (response.status == 1) {
                        $("#selInventoryShelfId").empty();
                        response.object.forEach(function (i) {
                            var option = document.createElement("option");
                            option.text = i.text;
                            option.value = i.value;
                            if (LocationIdValue != null && LocationIdValue != "null" && LocationIdValue != "" && LocationIdValue == i.value) {
                                option.selected = true;
                            }
                            $('#selInventoryShelfId').append(option);
                        });
                    } else {
                        throwException(response);
                    }
                },
                failure: function (response) {
                    throwException(response)
                },
                error: function (response) {
                    throwException(response)
                }
            });
        } else {

            $("#selInventoryShelfId").empty();
            var option = document.createElement("option");
            option.text = "Please select one";
            $('#selInventoryShelfId').append(option);

        }
    }

    function submitInvItem() {
    
        var form = document.getElementById('frmSubmitInvItem');
        var formData = new FormData(form);
        getspinner();
        $.ajax({
            type: "Post",
            url: "/InventoryItem/EditItemForSpareparts",
            data: formData,
            processData: false,
            ///* processData: false,*/
            contentType: false,
            success: function (response) {
                $("#ChangingBody").empty();
                $('#ChangingBody').append(response);
               
                openTablink(event, 'divOnHand');
                
               
            },
            failure: function (response) {
                throwException(response)
            },
            error: function (response) {
                throwException(response)
            }
        });
       

    }
    if (SubWarehouseId.value != null && SubWarehouseId.value != "null" && SubWarehouseId.value != "") {
        GetLaneWarehouse(SubWarehouseId.value);
        if (LaneId.value != null && LaneId.value != "null" && LaneId.value != "") {
            GetShelfWarehouse(LaneId.value);
        }
    }
    onChangeselCodeType(selCodeType.value);
    document.getElementById("btnGoToTopPage").click();

</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}




}
